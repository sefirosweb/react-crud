import{j as c}from"./ThemeProvider-a71a5aa9.js";import{r as l}from"./index-61bf1805.js";import{T as k}from"./index-08f36b8f.js";import{I as F}from"./index-8b309e46.js";import{D as N}from"./index-5be08948.js";import{a as I}from"./axios-94372f69.js";import{S as B,s as G,b as H,n as x,p as W,c as T,d as J,e as X,a as Y,u as Z,Q as $}from"./useGetQueryClient-cbcca069.js";import{u as ee}from"./useTranslation-9aad8729.js";class te extends B{constructor(e,t){super(),this.client=e,this.setOptions(t),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var t;const s=this.options;this.options=this.client.defaultMutationOptions(e),G(s,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),(t=this.currentMutation)==null||t.setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var e;(e=this.currentMutation)==null||e.removeObserver(this)}}onMutationUpdate(e){this.updateResult();const t={listeners:!0};e.type==="success"?t.onSuccess=!0:e.type==="error"&&(t.onError=!0),this.notify(t)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(e,t){return this.mutateOptions=t,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof e<"u"?e:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const e=this.currentMutation?this.currentMutation.state:H(),t={...e,isLoading:e.status==="loading",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=t}notify(e){x.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(e.onSuccess){var t,s,o,a;(t=(s=this.mutateOptions).onSuccess)==null||t.call(s,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(o=(a=this.mutateOptions).onSettled)==null||o.call(a,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(e.onError){var r,p,i,h;(r=(p=this.mutateOptions).onError)==null||r.call(p,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(i=(h=this.mutateOptions).onSettled)==null||i.call(h,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}e.listeners&&this.listeners.forEach(({listener:b})=>{b(this.currentResult)})})}}function ae(u,e,t){const s=W(u,e,t),o=T({context:s.context}),[a]=l.useState(()=>new te(o,s));l.useEffect(()=>{a.setOptions(s)},[a,s]);const r=J(l.useCallback(i=>a.subscribe(x.batchCalls(i)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),p=l.useCallback((i,h)=>{a.mutate(i,h).catch(re)},[a]);if(r.error&&X(a.options.useErrorBoundary,[r.error]))throw r.error;return{...r,mutate:p,mutateAsync:r.mutate}}function re(){}const se=u=>{const{crud:e,dataToSend:t,url:s}=u;return new Promise((o,a)=>{switch(e){case"CREATE":I.post(s,t).then(r=>{if(r.data.success!==!0)return a("The response dosen't response success");o(r.data)}).catch(a);break;case"DELETE":I.delete(s,{data:t}).then(r=>{if(r.data.success!==!0)return a("The response dosen't response success");o(r.data)}).catch(a);break}})},ne=(u,e)=>new Promise((t,s)=>{if(!u){t(null);return}I.get(u,{params:e}).then(o=>t(o.data)).catch(s)}),ie=l.forwardRef((u,e)=>{const{autoSave:t=!0,label:s,sentKeyAs:o,primaryKey:a,primaryKeyId:r,sentPrimaryKeyIdAs:p="primaryKeyId",crudUrl:i="",columns:h,getDataUrl:b,lazyLoad:A,handleIsLoading:M,handleChange:D}=u,E=o??a,w=t?A:!1,[S,O]=l.useState(!1),[f,y]=l.useState([]),v=l.useRef(null),V=[...h],U=T(),{t:Q}=ee(),{data:g,isRefetching:C,isLoading:R}=Y({queryKey:[i,r],queryFn:()=>ne(i,{[p]:r}),refetchOnReconnect:!1,refetchOnWindowFocus:!1}),{mutate:K,isLoading:q}=ae({mutationFn:se,onSettled:n=>{var d;n.success&&(U.invalidateQueries({queryKey:[i,r]}),(d=v.current)==null||d.clear())}});l.useEffect(()=>{O(C||q||R),M&&M(C||q||R)},[C,q,R,M]),l.useEffect(()=>{if(!g)return;const n=g.data;g.success&&y(n)},[g,y]),l.useEffect(()=>{D&&D(f)},[f]),V.push({header:Q("Delete"),id:"delete_crud",cell:n=>c.jsx(N,{disabled:S,onClick:()=>_(n.row.original)})});const _=n=>{if(t){if(!i)return;const d={...n,[E]:n[a],[p]:r};K({crud:"DELETE",url:i,dataToSend:d})}else{const d=f.filter(m=>m[a]!==n[a]);y(d)}},P=n=>{var d;if(t){if(!i)return;const m={...n,[E]:n[a],[p]:r};K({crud:"CREATE",url:i,dataToSend:m})}else{const m=[...f],j=m.findIndex(z=>z[a]===n[a]);if((d=v.current)==null||d.clear(),j>=0)return;m.push(n),y(m)}};return l.useImperativeHandle(e,()=>({getIds(){return f.map(n=>n[a])},getTableData(){return f}})),c.jsxs(c.Fragment,{children:[c.jsx(F,{label:s,ref:v,url:b,lazyLoad:w,onAcceptButton:P,isLoading:S}),c.jsx(k,{className:"mt-2",columns:V,data:f,isLoading:S})]})}),L=l.forwardRef((u,e)=>{const t=Z();return c.jsx(c.Fragment,{children:c.jsx($,{client:t,children:c.jsx(ie,{...u,ref:e})})})});try{L.displayName="MultiSelectCrudTable",L.__docgenInfo={description:"",displayName:"MultiSelectCrudTable",props:{label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string"}},sentKeyAs:{defaultValue:null,description:"",name:"sentKeyAs",required:!1,type:{name:"string"}},primaryKey:{defaultValue:null,description:"",name:"primaryKey",required:!0,type:{name:"string"}},primaryKeyId:{defaultValue:null,description:"",name:"primaryKeyId",required:!0,type:{name:"string"}},sentPrimaryKeyIdAs:{defaultValue:null,description:"",name:"sentPrimaryKeyIdAs",required:!1,type:{name:"string"}},crudUrl:{defaultValue:null,description:"",name:"crudUrl",required:!1,type:{name:"string"}},getDataUrl:{defaultValue:null,description:"",name:"getDataUrl",required:!0,type:{name:"string"}},lazyLoad:{defaultValue:null,description:"",name:"lazyLoad",required:!1,type:{name:"boolean"}},autoSave:{defaultValue:null,description:"",name:"autoSave",required:!1,type:{name:"boolean"}},columns:{defaultValue:null,description:"",name:"columns",required:!0,type:{name:"ColumnDefinition<any>[]"}},handleIsLoading:{defaultValue:null,description:"",name:"handleIsLoading",required:!1,type:{name:"Dispatch<SetStateAction<boolean>>"}},handleChange:{defaultValue:null,description:"",name:"handleChange",required:!1,type:{name:"((dataModal: DataField[]) => void)"}}}}}catch{}try{MultiSelectCrudTable.displayName="MultiSelectCrudTable",MultiSelectCrudTable.__docgenInfo={description:"",displayName:"MultiSelectCrudTable",props:{label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string"}},sentKeyAs:{defaultValue:null,description:"",name:"sentKeyAs",required:!1,type:{name:"string"}},primaryKey:{defaultValue:null,description:"",name:"primaryKey",required:!0,type:{name:"string"}},primaryKeyId:{defaultValue:null,description:"",name:"primaryKeyId",required:!0,type:{name:"string"}},sentPrimaryKeyIdAs:{defaultValue:null,description:"",name:"sentPrimaryKeyIdAs",required:!1,type:{name:"string"}},crudUrl:{defaultValue:null,description:"",name:"crudUrl",required:!1,type:{name:"string"}},getDataUrl:{defaultValue:null,description:"",name:"getDataUrl",required:!0,type:{name:"string"}},lazyLoad:{defaultValue:null,description:"",name:"lazyLoad",required:!1,type:{name:"boolean"}},autoSave:{defaultValue:null,description:"",name:"autoSave",required:!1,type:{name:"boolean"}},columns:{defaultValue:null,description:"",name:"columns",required:!0,type:{name:"ColumnDefinition<any>[]"}},handleIsLoading:{defaultValue:null,description:"",name:"handleIsLoading",required:!1,type:{name:"Dispatch<SetStateAction<boolean>>"}},handleChange:{defaultValue:null,description:"",name:"handleChange",required:!1,type:{name:"((dataModal: DataField[]) => void)"}}}}}catch{}export{L as M,ae as u};
//# sourceMappingURL=index-e46df336.js.map
